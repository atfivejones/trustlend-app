<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demand Letter Generator - TrustLend</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="mobile-enhancements.css">
    <script src="smart-form-enhancements.js"></script>
    <style>
        .hero-gradient {
            background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 50%, #7c3aed 100%);
        }
        .letter-preview {
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            font-family: 'Times New Roman', serif;
            line-height: 1.6;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-2">
                    <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center">
                        <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                    <span class="text-xl font-bold text-gray-900">TrustLend</span>
                </div>
                
                <div class="flex items-center space-x-4">
                    <a href="dashboard.html" class="text-gray-600 hover:text-gray-900">← Dashboard</a>
                    <div class="text-sm text-gray-600">Demand Letter Generator</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Header Section -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-900 mb-4">⚖️ Legal Demand Letter Generator</h1>
            <p class="text-xl text-gray-600 max-w-3xl mx-auto">Create professional demand letters for overdue loan payments. Court-admissible and attorney-reviewed templates.</p>
        </div>

        <!-- Warning Notice -->
        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-6 mb-8">
            <div class="flex">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                    </svg>
                </div>
                <div class="ml-3">
                    <h3 class="text-sm font-medium text-yellow-800">Legal Notice</h3>
                    <p class="mt-1 text-sm text-yellow-700">This demand letter is the final step before legal action. Sending this letter establishes a legal record and may be required before filing in small claims court.</p>
                </div>
            </div>
        </div>

        <div class="grid lg:grid-cols-2 gap-8">
            <!-- Letter Builder Form -->
            <div class="bg-white rounded-xl border border-gray-200 p-6">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Build Your Demand Letter</h2>
                
                <form id="demand-letter-form" class="space-y-6">
                    <!-- Contract Selection -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Select Contract</label>
                        <select id="contract-select" class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                            <option value="">Choose a contract...</option>
                            <option value="TL-001" data-borrower="Sarah Johnson" data-amount="5050" data-due="2025-02-25">Sarah Johnson - $5,050 (Due Feb 25, 2025)</option>
                            <option value="TL-002" data-borrower="Mike Thompson" data-amount="2525" data-due="2024-12-15">Mike Thompson - $2,525 (Due Dec 15, 2024) - OVERDUE</option>
                            <option value="TL-003" data-borrower="Janet Miller" data-amount="750" data-due="2025-01-30">Janet Miller - $750 (Due Jan 30, 2025)</option>
                        </select>
                    </div>

                    <!-- Demand Type -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Demand Type</label>
                        <select id="demand-type" class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                            <option value="friendly">Friendly Reminder (First Notice)</option>
                            <option value="formal">Formal Demand (Second Notice)</option>
                            <option value="final">Final Demand Before Legal Action</option>
                            <option value="attorney">Attorney Demand Letter</option>
                        </select>
                    </div>

                    <!-- Days Overdue (Auto-calculated) -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Days Overdue</label>
                        <input type="number" id="days-overdue" class="w-full px-3 py-3 border border-gray-300 rounded-lg bg-gray-50" readonly>
                    </div>

                    <!-- Total Amount Due -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Total Amount Due</label>
                        <div class="flex space-x-4">
                            <input type="number" id="principal-due" placeholder="Principal" class="flex-1 px-3 py-3 border border-gray-300 rounded-lg" readonly>
                            <input type="number" id="late-fees" placeholder="Late Fees" class="flex-1 px-3 py-3 border border-gray-300 rounded-lg">
                            <input type="number" id="total-due" placeholder="Total Due" class="flex-1 px-3 py-3 border border-gray-300 rounded-lg bg-gray-50" readonly>
                        </div>
                    </div>

                    <!-- Payment Deadline -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Payment Deadline</label>
                        <select id="payment-deadline" class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="7">7 days from letter date</option>
                            <option value="10">10 days from letter date</option>
                            <option value="14">14 days from letter date</option>
                            <option value="30">30 days from letter date</option>
                        </select>
                    </div>

                    <!-- Legal Action Type -->
                    <div id="legal-action-section" class="hidden">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Threatened Legal Action</label>
                        <select id="legal-action" class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="small-claims">Small Claims Court Filing</option>
                            <option value="collections">Collections Agency Referral</option>
                            <option value="credit-report">Credit Bureau Reporting</option>
                            <option value="all">All of the Above</option>
                        </select>
                    </div>

                    <!-- Additional Notes -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Additional Information (Optional)</label>
                        <textarea id="additional-notes" rows="3" class="w-full px-3 py-3 border border-gray-300 rounded-lg" placeholder="Any additional context or payment arrangements offered..."></textarea>
                    </div>

                    <!-- Generate Button -->
                    <button type="button" onclick="generateDemandLetter()" class="w-full bg-red-600 text-white py-3 px-6 rounded-lg font-bold hover:bg-red-700 transition-all">
                        Generate Demand Letter
                    </button>
                </form>
            </div>

            <!-- Letter Preview -->
            <div class="bg-white rounded-xl border border-gray-200 p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">Letter Preview</h2>
                    <div class="space-x-2">
                        <button onclick="downloadLetter()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-all">
                            Download PDF
                        </button>
                        <button onclick="emailLetter()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-all">
                            Email Letter
                        </button>
                    </div>
                </div>

                <!-- Letter Content -->
                <div id="letter-preview" class="letter-preview p-8 min-h-96">
                    <div class="text-center text-gray-400 py-20">
                        <svg class="w-16 h-16 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <p>Select a contract and demand type to preview your letter</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Legal Guidance Section -->
        <div class="mt-12 bg-white rounded-xl border border-gray-200 p-6">
            <h3 class="text-xl font-bold text-gray-900 mb-4">📚 Legal Guidance & Best Practices</h3>
            
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <h4 class="font-semibold text-gray-800 mb-2">When to Send a Demand Letter:</h4>
                    <ul class="text-sm text-gray-600 space-y-1">
                        <li>• Payment is 7+ days overdue</li>
                        <li>• Previous reminders have been ignored</li>
                        <li>• Before filing legal action (often required)</li>
                        <li>• To establish a legal paper trail</li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="font-semibold text-gray-800 mb-2">Legal Requirements:</h4>
                    <ul class="text-sm text-gray-600 space-y-1">
                        <li>• Send via certified mail with return receipt</li>
                        <li>• Keep copies of all correspondence</li>
                        <li>• Allow reasonable time for response (7-30 days)</li>
                        <li>• Be factual and professional in tone</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Contract data management
        const contractData = {};

        // Initialize form
        document.getElementById('contract-select').addEventListener('change', function() {
            const selectedOption = this.selectedOptions[0];
            if (selectedOption.value) {
                contractData.borrower = selectedOption.dataset.borrower;
                contractData.amount = parseFloat(selectedOption.dataset.amount);
                contractData.dueDate = selectedOption.dataset.due;
                
                updateFormData();
            }
        });

        // Update demand type visibility
        document.getElementById('demand-type').addEventListener('change', function() {
            const legalSection = document.getElementById('legal-action-section');
            if (this.value === 'final' || this.value === 'attorney') {
                legalSection.classList.remove('hidden');
            } else {
                legalSection.classList.add('hidden');
            }
        });

        function updateFormData() {
            // Calculate days overdue
            const today = new Date();
            const dueDate = new Date(contractData.dueDate);
            const daysOverdue = Math.max(0, Math.ceil((today - dueDate) / (1000 * 60 * 60 * 24)));
            
            document.getElementById('days-overdue').value = daysOverdue;
            document.getElementById('principal-due').value = contractData.amount;
            
            // Calculate late fees (example: $25/day after 7 days)
            const lateFees = daysOverdue > 7 ? (daysOverdue - 7) * 25 : 0;
            document.getElementById('late-fees').value = lateFees;
            
            // Update total
            updateTotal();
        }

        function updateTotal() {
            const principal = parseFloat(document.getElementById('principal-due').value) || 0;
            const lateFees = parseFloat(document.getElementById('late-fees').value) || 0;
            document.getElementById('total-due').value = principal + lateFees;
        }

        // Late fees input listener
        document.getElementById('late-fees').addEventListener('input', updateTotal);

        function generateDemandLetter() {
            const form = document.getElementById('demand-letter-form');
            const formData = new FormData(form);
            
            if (!contractData.borrower) {
                alert('Please select a contract first');
                return;
            }
            
            const letterType = document.getElementById('demand-type').value;
            const paymentDeadline = document.getElementById('payment-deadline').value;
            const totalDue = document.getElementById('total-due').value;
            const additionalNotes = document.getElementById('additional-notes').value;
            
            const letter = generateLetterContent(letterType, contractData, totalDue, paymentDeadline, additionalNotes);
            
            document.getElementById('letter-preview').innerHTML = letter;
        }

        function generateLetterContent(type, contract, totalDue, deadline, notes) {
            const today = new Date().toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            const deadlineDate = new Date();
            deadlineDate.setDate(deadlineDate.getDate() + parseInt(deadline));
            const deadlineDateStr = deadlineDate.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });

            let letterContent = '';
            
            switch(type) {
                case 'friendly':
                    letterContent = `
                        <div class="mb-6">
                            <div class="text-right text-sm text-gray-600">${today}</div>
                        </div>
                        
                        <div class="mb-6">
                            <strong>${contract.borrower}</strong><br>
                            [Borrower Address]
                        </div>
                        
                        <div class="mb-6">
                            <strong>Re: Overdue Loan Payment - Friendly Reminder</strong>
                        </div>
                        
                        <div class="mb-4">Dear ${contract.borrower},</div>
                        
                        <div class="mb-4">
                            I hope this letter finds you well. I am writing to remind you that your loan payment of <strong>$${totalDue}</strong> was due on <strong>${new Date(contract.dueDate).toLocaleDateString()}</strong> and is now overdue.
                        </div>
                        
                        <div class="mb-4">
                            I understand that financial situations can be challenging, and I wanted to reach out personally before taking any further action. If you are experiencing difficulties, please contact me immediately so we can discuss possible arrangements.
                        </div>
                        
                        <div class="mb-4">
                            Please submit payment in full by <strong>${deadlineDateStr}</strong> to avoid any late fees or further collection actions.
                        </div>
                        
                        ${notes ? `<div class="mb-4">${notes}</div>` : ''}
                        
                        <div class="mb-4">
                            Thank you for your immediate attention to this matter.
                        </div>
                        
                        <div class="mt-8">
                            Sincerely,<br><br>
                            [Your Name]<br>
                            [Your Contact Information]
                        </div>
                    `;
                    break;
                    
                case 'formal':
                    letterContent = `
                        <div class="mb-6">
                            <div class="text-right text-sm text-gray-600">${today}</div>
                        </div>
                        
                        <div class="mb-6">
                            <strong>${contract.borrower}</strong><br>
                            [Borrower Address]
                        </div>
                        
                        <div class="mb-6">
                            <strong>Re: FORMAL DEMAND FOR PAYMENT - Loan Default Notice</strong>
                        </div>
                        
                        <div class="mb-4">Dear ${contract.borrower},</div>
                        
                        <div class="mb-4">
                            <strong>DEMAND IS HEREBY MADE</strong> for immediate payment of the past due amount of <strong>$${totalDue}</strong> under the loan agreement executed between us.
                        </div>
                        
                        <div class="mb-4">
                            According to our records, your payment was due on <strong>${new Date(contract.dueDate).toLocaleDateString()}</strong> and remains unpaid despite previous notice. This constitutes a default under the terms of our agreement.
                        </div>
                        
                        <div class="mb-4">
                            <strong>YOU ARE HEREBY NOTIFIED</strong> that unless payment in full is received by <strong>${deadlineDateStr}</strong>, I will be forced to pursue all available legal remedies, which may include:
                        </div>
                        
                        <div class="mb-4 ml-6">
                            • Filing suit against you for the full amount due plus interest and costs<br>
                            • Reporting this debt to credit agencies<br>
                            • Pursuing collection through legal channels
                        </div>
                        
                        ${notes ? `<div class="mb-4">${notes}</div>` : ''}
                        
                        <div class="mb-4">
                            This letter serves as a final opportunity to resolve this matter without legal action.
                        </div>
                        
                        <div class="mt-8">
                            Very truly yours,<br><br>
                            [Your Name]<br>
                            [Your Contact Information]
                        </div>
                    `;
                    break;
                    
                case 'final':
                    letterContent = `
                        <div class="mb-6">
                            <div class="text-right text-sm text-gray-600">${today}</div>
                        </div>
                        
                        <div class="mb-6">
                            <strong>${contract.borrower}</strong><br>
                            [Borrower Address]
                        </div>
                        
                        <div class="mb-6 text-center">
                            <strong class="text-red-600">FINAL DEMAND BEFORE LEGAL ACTION</strong>
                        </div>
                        
                        <div class="mb-4">Dear ${contract.borrower},</div>
                        
                        <div class="mb-4">
                            <strong>THIS IS YOUR FINAL NOTICE</strong> before legal proceedings are commenced against you for the collection of the past due amount of <strong>$${totalDue}</strong>.
                        </div>
                        
                        <div class="mb-4">
                            Despite previous demands for payment, you have failed to satisfy your obligation under our loan agreement. Your payment was due on <strong>${new Date(contract.dueDate).toLocaleDateString()}</strong>.
                        </div>
                        
                        <div class="mb-4">
                            <strong>TAKE NOTICE</strong> that if payment in full is not received within <strong>${deadline} days</strong> from the date of this letter (by <strong>${deadlineDateStr}</strong>), legal action will be commenced against you without further notice.
                        </div>
                        
                        <div class="mb-4">
                            Such legal action may result in:
                        </div>
                        
                        <div class="mb-4 ml-6">
                            • A judgment against you for the full amount due<br>
                            • Additional court costs and attorney fees<br>
                            • Potential wage garnishment<br>
                            • Negative impact on your credit rating<br>
                            • Asset seizure or bank account levies
                        </div>
                        
                        ${notes ? `<div class="mb-4">${notes}</div>` : ''}
                        
                        <div class="mb-4">
                            <strong>TIME IS OF THE ESSENCE.</strong> This matter requires your immediate attention.
                        </div>
                        
                        <div class="mt-8">
                            Very truly yours,<br><br>
                            [Your Name]<br>
                            [Your Contact Information]<br>
                            <em>Creditor</em>
                        </div>
                    `;
                    break;
            }
            
            return letterContent;
        }

        function downloadLetter() {
            const letterContent = document.getElementById('letter-preview').innerHTML;
            if (letterContent.includes('Select a contract')) {
                alert('Please generate a letter first');
                return;
            }
            
            // Create printable version
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Demand Letter</title>
                    <style>
                        body { font-family: 'Times New Roman', serif; padding: 40px; line-height: 1.6; }
                        .text-red-600 { color: red; font-weight: bold; }
                    </style>
                </head>
                <body>
                    ${letterContent}
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        function emailLetter() {
            alert('📧 Email feature coming soon!\n\nFor now, you can:\n• Download the PDF\n• Send via your email client\n• Use certified mail for legal validity');
        }
    </script>
</body>
</html>