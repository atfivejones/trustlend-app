<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Promissory Note - TrustLend</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: white;
            padding: 24px 30px;
            border-bottom: 2px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            color: #1a1a1a;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            font-weight: 700;
        }

        .logo-text {
            font-size: 24px;
            font-weight: 700;
            color: #1a1a1a;
        }

        .header-actions {
            display: flex;
            gap: 16px;
        }

        .header-btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header-btn.secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .header-btn.secondary:hover {
            background: #f8f9ff;
        }

        .progress-container {
            padding: 40px 30px 30px;
            background: #fafafa;
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            position: relative;
        }

        .progress-line {
            position: absolute;
            top: 20px;
            left: 40px;
            right: 40px;
            height: 3px;
            background: #e0e0e0;
            z-index: 0;
        }

        .progress-line-active {
            position: absolute;
            top: 20px;
            left: 40px;
            height: 3px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            z-index: 1;
            transition: width 0.3s ease;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: 3px solid #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: #999;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .step.active .step-number {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: white;
            transform: scale(1.1);
        }

        .step.completed .step-number {
            background: #10b981;
            border-color: #10b981;
            color: white;
        }

        .step-label {
            font-size: 13px;
            color: #666;
            font-weight: 500;
            white-space: nowrap;
        }

        .step.active .step-label {
            color: #667eea;
            font-weight: 600;
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            padding: 40px;
        }

        .main-content {
            min-height: 500px;
        }

        .step-title {
            font-size: 28px;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 8px;
        }

        .step-description {
            font-size: 16px;
            color: #666;
            margin-bottom: 30px;
        }

        .form-section {
            display: none;
        }

        .form-section.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-group.half {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
            font-size: 14px;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.2s;
            font-family: inherit;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .radio-group {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .radio-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            flex: 1;
            min-width: 140px;
        }

        .radio-item:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .radio-item.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .radio-item input[type="radio"] {
            margin: 0;
        }

        /* Payment Schedule Breakdown */
        .payment-breakdown {
            background: linear-gradient(135deg, #f0f4ff 0%, #e0f2fe 100%);
            border: 2px solid #667eea;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }

        .payment-breakdown.active {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .breakdown-title {
            font-size: 18px;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .breakdown-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .breakdown-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .breakdown-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 4px;
        }

        .breakdown-value {
            font-size: 16px;
            font-weight: 700;
            color: #1a1a1a;
        }

        .payment-schedule-table {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            max-height: 200px;
            overflow-y: auto;
        }

        .payment-schedule-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .payment-schedule-table th {
            background: #667eea;
            color: white;
            padding: 8px;
            font-size: 12px;
            font-weight: 600;
            text-align: left;
        }

        .payment-schedule-table td {
            padding: 6px 8px;
            font-size: 11px;
            border-bottom: 1px solid #f0f0f0;
        }

        .payment-schedule-table tr:nth-child(even) {
            background: #f9f9f9;
        }

        /* UCC Provisions */
        .ucc-section {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #f59e0b;
            border-radius: 12px;
            padding: 20px;
            margin: 24px 0;
        }

        .ucc-title {
            font-size: 18px;
            font-weight: 700;
            color: #92400e;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ucc-checkbox {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 16px;
        }

        .ucc-checkbox input[type="checkbox"] {
            margin-top: 4px;
            transform: scale(1.2);
        }

        .ucc-provisions {
            background: white;
            border-radius: 8px;
            padding: 16px;
            margin-top: 12px;
            font-size: 13px;
            line-height: 1.6;
            color: #374151;
            max-height: 120px;
            overflow-y: auto;
        }

        .ucc-provision {
            margin-bottom: 12px;
        }

        .ucc-provision strong {
            color: #1a1a1a;
        }

        /* Sidebar */
        .sidebar {
            background: #f8fafc;
            border-radius: 16px;
            padding: 24px;
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        .preview-title {
            font-size: 20px;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 20px;
            text-align: center;
        }

        .preview-section {
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e5e7eb;
        }

        .preview-section:last-child {
            border-bottom: none;
        }

        .preview-label {
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .preview-value {
            font-size: 16px;
            font-weight: 600;
            color: #1a1a1a;
        }

        .preview-amount {
            font-size: 24px;
            font-weight: 700;
            color: #667eea;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 16px;
            margin-top: 40px;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #f8f9ff;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Review Section */
        .review-grid {
            display: grid;
            gap: 20px;
            margin-bottom: 30px;
        }

        .review-card {
            background: #f8fafc;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
        }

        .review-card-title {
            font-size: 16px;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .review-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .review-item-label {
            color: #6b7280;
        }

        .review-item-value {
            font-weight: 600;
            color: #1a1a1a;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 20px;
            }
            
            .form-group.half {
                grid-template-columns: 1fr;
            }
            
            .radio-group {
                flex-direction: column;
            }
            
            .action-buttons {
                flex-direction: column;
            }

            .breakdown-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <a href="dashboard.html" class="logo">
                <div class="logo-icon">T</div>
                <div class="logo-text">TrustLend</div>
            </a>
            <div class="header-actions">
                <button class="header-btn secondary" onclick="saveDraft()">Save Draft</button>
                <a href="dashboard.html" class="header-btn secondary">Dashboard</a>
            </div>
        </div>

        <!-- Progress -->
        <div class="progress-container">
            <div class="progress-steps">
                <div class="progress-line"></div>
                <div class="progress-line-active" id="progressLine" style="width: 25%;"></div>
                
                <div class="step active" id="step1">
                    <div class="step-number">1</div>
                    <div class="step-label">Loan Details</div>
                </div>
                <div class="step" id="step2">
                    <div class="step-number">2</div>
                    <div class="step-label">Parties</div>
                </div>
                <div class="step" id="step3">
                    <div class="step-number">3</div>
                    <div class="step-label">Terms & UCC</div>
                </div>
                <div class="step" id="step4">
                    <div class="step-number">4</div>
                    <div class="step-label">Review</div>
                </div>
                <div class="step" id="step5">
                    <div class="step-number">5</div>
                    <div class="step-label">Sign</div>
                </div>
            </div>
        </div>

        <!-- Content -->
        <div class="content">
            <!-- Main Content -->
            <div class="main-content">
                
                <!-- Step 1: Loan Details -->
                <div class="form-section active" id="section1">
                    <div class="step-title">Loan Details</div>
                    <div class="step-description">Enter the basic details of your promissory note</div>
                    
                    <div class="form-group half">
                        <div>
                            <label class="form-label">Principal Amount</label>
                            <input type="number" id="principalAmount" class="form-input" placeholder="5000.00" step="0.01">
                        </div>
                        <div>
                            <label class="form-label">Service Fee (Optional)</label>
                            <input type="number" id="serviceFee" class="form-input" placeholder="50.00" step="0.01">
                        </div>
                    </div>

                    <div class="form-group half">
                        <div>
                            <label class="form-label">Loan Date</label>
                            <input type="date" id="loanDate" class="form-input">
                        </div>
                        <div>
                            <label class="form-label">Due Date</label>
                            <input type="date" id="dueDate" class="form-input">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Purpose of Loan</label>
                        <select id="purpose" class="form-select">
                            <option value="">Select purpose</option>
                            <option value="personal">Personal Use</option>
                            <option value="business">Business Investment</option>
                            <option value="education">Education</option>
                            <option value="medical">Medical Expenses</option>
                            <option value="home_improvement">Home Improvement</option>
                            <option value="debt_consolidation">Debt Consolidation</option>
                            <option value="vehicle">Vehicle Purchase</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Payment Schedule</label>
                        <div class="radio-group">
                            <label class="radio-item selected" onclick="selectPaymentSchedule(this, 'lump')">
                                <input type="radio" name="paymentSchedule" value="lump" checked>
                                <span>Lump Sum</span>
                            </label>
                            <label class="radio-item" onclick="selectPaymentSchedule(this, 'monthly')">
                                <input type="radio" name="paymentSchedule" value="monthly">
                                <span>Monthly</span>
                            </label>
                            <label class="radio-item" onclick="selectPaymentSchedule(this, 'weekly')">
                                <input type="radio" name="paymentSchedule" value="weekly">
                                <span>Weekly</span>
                            </label>
                            <label class="radio-item" onclick="selectPaymentSchedule(this, 'biweekly')">
                                <input type="radio" name="paymentSchedule" value="biweekly">
                                <span>Bi-weekly</span>
                            </label>
                        </div>
                    </div>

                    <!-- Payment Schedule Breakdown -->
                    <div class="payment-breakdown" id="paymentBreakdown">
                        <div class="breakdown-title">
                            📊 Payment Schedule Breakdown
                        </div>
                        
                        <div class="breakdown-grid">
                            <div class="breakdown-item">
                                <div class="breakdown-label">Payment Amount</div>
                                <div class="breakdown-value" id="paymentAmount">$0.00</div>
                            </div>
                            <div class="breakdown-item">
                                <div class="breakdown-label">Number of Payments</div>
                                <div class="breakdown-value" id="numberOfPayments">0</div>
                            </div>
                            <div class="breakdown-item">
                                <div class="breakdown-label">Total Interest</div>
                                <div class="breakdown-value" id="totalInterest">$0.00</div>
                            </div>
                            <div class="breakdown-item">
                                <div class="breakdown-label">Total Amount</div>
                                <div class="breakdown-value" id="totalAmount">$0.00</div>
                            </div>
                        </div>

                        <div class="payment-schedule-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Payment #</th>
                                        <th>Due Date</th>
                                        <th>Amount</th>
                                        <th>Principal</th>
                                        <th>Interest</th>
                                    </tr>
                                </thead>
                                <tbody id="paymentScheduleTable">
                                    <!-- Payment rows will be generated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="nextStep(2)">Continue</button>
                    </div>
                </div>

                <!-- Step 2: Parties -->
                <div class="form-section" id="section2">
                    <div class="step-title">Parties Information</div>
                    <div class="step-description">Enter lender and borrower details</div>
                    
                    <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 16px; color: #1a1a1a;">Lender Information</h3>
                    
                    <div class="form-group half">
                        <div>
                            <label class="form-label">First Name</label>
                            <input type="text" id="lenderFirstName" class="form-input">
                        </div>
                        <div>
                            <label class="form-label">Last Name</label>
                            <input type="text" id="lenderLastName" class="form-input">
                        </div>
                    </div>

                    <div class="form-group half">
                        <div>
                            <label class="form-label">Email</label>
                            <input type="email" id="lenderEmail" class="form-input">
                        </div>
                        <div>
                            <label class="form-label">Phone</label>
                            <input type="tel" id="lenderPhone" class="form-input">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Address</label>
                        <input type="text" id="lenderAddress" class="form-input">
                    </div>

                    <div class="form-group half">
                        <div>
                            <label class="form-label">City</label>
                            <input type="text" id="lenderCity" class="form-input">
                        </div>
                        <div>
                            <label class="form-label">State</label>
                            <input type="text" id="lenderState" class="form-input">
                        </div>
                    </div>

                    <div class="form-group half">
                        <div>
                            <label class="form-label">ZIP Code</label>
                            <input type="text" id="lenderZip" class="form-input">
                        </div>
                        <div>
                            <label class="form-label">County</label>
                            <input type="text" id="lenderCounty" class="form-input">
                        </div>
                    </div>

                    <h3 style="font-size: 18px; font-weight: 600; margin: 32px 0 16px; color: #1a1a1a;">Borrower Information</h3>
                    
                    <div class="form-group half">
                        <div>
                            <label class="form-label">First Name</label>
                            <input type="text" id="borrowerFirstName" class="form-input">
                        </div>
                        <div>
                            <label class="form-label">Last Name</label>
                            <input type="text" id="borrowerLastName" class="form-input">
                        </div>
                    </div>

                    <div class="form-group half">
                        <div>
                            <label class="form-label">Email</label>
                            <input type="email" id="borrowerEmail" class="form-input">
                        </div>
                        <div>
                            <label class="form-label">Phone</label>
                            <input type="tel" id="borrowerPhone" class="form-input">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Address</label>
                        <input type="text" id="borrowerAddress" class="form-input">
                    </div>

                    <div class="form-group half">
                        <div>
                            <label class="form-label">City</label>
                            <input type="text" id="borrowerCity" class="form-input">
                        </div>
                        <div>
                            <label class="form-label">State</label>
                            <input type="text" id="borrowerState" class="form-input">
                        </div>
                    </div>

                    <div class="form-group half">
                        <div>
                            <label class="form-label">ZIP Code</label>
                            <input type="text" id="borrowerZip" class="form-input">
                        </div>
                        <div>
                            <label class="form-label">SSN (Last 4)</label>
                            <input type="text" id="borrowerSSN" class="form-input" maxlength="4" placeholder="1234">
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button class="btn btn-secondary" onclick="prevStep(1)">Previous</button>
                        <button class="btn btn-primary" onclick="nextStep(3)">Continue</button>
                    </div>
                </div>

                <!-- Step 3: Terms & UCC -->
                <div class="form-section" id="section3">
                    <div class="step-title">Terms & Legal Provisions</div>
                    <div class="step-description">Configure payment terms and UCC Article 9 provisions</div>
                    
                    <div class="form-group half">
                        <div>
                            <label class="form-label">Interest Rate (%)</label>
                            <input type="number" id="interestRate" class="form-input" placeholder="5.0" step="0.01">
                        </div>
                        <div>
                            <label class="form-label">Late Fee ($)</label>
                            <input type="number" id="lateFee" class="form-input" placeholder="25.00" step="0.01">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Grace Period (Days)</label>
                        <input type="number" id="gracePeriod" class="form-input" placeholder="10">
                    </div>

                    <!-- UCC Article 9 Section -->
                    <div class="ucc-section">
                        <div class="ucc-title">
                            ⚖️ UCC Article 9 Security Interest
                        </div>
                        
                        <div class="ucc-checkbox">
                            <input type="checkbox" id="enableUCC" onchange="toggleUCCProvisions()">
                            <label for="enableUCC">
                                <strong>Enable UCC Article 9 Security Interest</strong><br>
                                <span style="font-size: 13px; color: #6b7280;">
                                    Include security interest provisions to protect your loan with legal collateral rights
                                </span>
                            </label>
                        </div>

                        <div class="ucc-provisions hidden" id="uccProvisions">
                            <div class="ucc-provision">
                                <strong>Security Interest:</strong> To secure payment and performance of all obligations under this Note, Borrower grants to Lender a security interest in all of Borrower's right, title, and interest in the following collateral.
                            </div>
                            <div class="ucc-provision">
                                <strong>Collateral Description:</strong> All accounts, chattel paper, commercial tort claims, deposit accounts, documents, equipment, fixtures, general intangibles, goods, instruments, inventory, investment property, letter-of-credit rights, and supporting obligations, whether now owned or hereafter acquired, and all proceeds and products thereof.
                            </div>
                            <div class="ucc-provision">
                                <strong>Perfection:</strong> Borrower authorizes Lender to file such financing statements and other documents as Lender may deem necessary to perfect and maintain the security interest.
                            </div>
                            <div class="ucc-provision">
                                <strong>Default Remedies:</strong> Upon default, Lender may exercise all rights and remedies available under the Uniform Commercial Code and other applicable law, including but not limited to taking possession of collateral and selling it at public or private sale.
                            </div>
                            <div class="ucc-provision">
                                <strong>Attorney Fees:</strong> If Lender employs an attorney to enforce this Note, Borrower agrees to pay all reasonable attorney fees and collection costs.
                            </div>
                            <div class="ucc-provision">
                                <strong>Venue:</strong> All disputes shall be resolved in the courts of <span id="venueCounty">[County]</span>, <span id="venueState">[State]</span>.
                            </div>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button class="btn btn-secondary" onclick="prevStep(2)">Previous</button>
                        <button class="btn btn-primary" onclick="nextStep(4)">Review Contract</button>
                    </div>
                </div>

                <!-- Step 4: Review -->
                <div class="form-section" id="section4">
                    <div class="step-title">Review Promissory Note</div>
                    <div class="step-description">Please review all details before proceeding to signatures</div>
                    
                    <div class="review-grid">
                        <!-- Loan Summary -->
                        <div class="review-card">
                            <div class="review-card-title">💰 Loan Summary</div>
                            <div class="review-item">
                                <span class="review-item-label">Principal Amount:</span>
                                <span class="review-item-value" id="reviewPrincipal">$0.00</span>
                            </div>
                            <div class="review-item">
                                <span class="review-item-label">Service Fee:</span>
                                <span class="review-item-value" id="reviewServiceFee">$0.00</span>
                            </div>
                            <div class="review-item">
                                <span class="review-item-label">Interest Rate:</span>
                                <span class="review-item-value" id="reviewInterestRate">0%</span>
                            </div>
                            <div class="review-item">
                                <span class="review-item-label">Total Amount:</span>
                                <span class="review-item-value" id="reviewTotalAmount">$0.00</span>
                            </div>
                            <div class="review-item">
                                <span class="review-item-label">Payment Schedule:</span>
                                <span class="review-item-value" id="reviewPaymentSchedule">Lump Sum</span>
                            </div>
                        </div>

                        <!-- Parties -->
                        <div class="review-card">
                            <div class="review-card-title">👥 Parties</div>
                            <div class="review-item">
                                <span class="review-item-label">Lender:</span>
                                <span class="review-item-value" id="reviewLender">-</span>
                            </div>
                            <div class="review-item">
                                <span class="review-item-label">Borrower:</span>
                                <span class="review-item-value" id="reviewBorrower">-</span>
                            </div>
                            <div class="review-item">
                                <span class="review-item-label">Venue:</span>
                                <span class="review-item-value" id="reviewVenue">-</span>
                            </div>
                        </div>

                        <!-- Legal Provisions -->
                        <div class="review-card">
                            <div class="review-card-title">⚖️ Legal Provisions</div>
                            <div class="review-item">
                                <span class="review-item-label">UCC Article 9:</span>
                                <span class="review-item-value" id="reviewUCC">Not Enabled</span>
                            </div>
                            <div class="review-item">
                                <span class="review-item-label">Late Fee:</span>
                                <span class="review-item-value" id="reviewLateFee">$0.00</span>
                            </div>
                            <div class="review-item">
                                <span class="review-item-label">Grace Period:</span>
                                <span class="review-item-value" id="reviewGracePeriod">0 days</span>
                            </div>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button class="btn btn-secondary" onclick="prevStep(3)">Previous</button>
                        <button class="btn btn-primary" onclick="proceedToSigning()">Proceed to Signing</button>
                    </div>
                </div>

                <!-- Step 5: Signing Redirect -->
                <div class="form-section" id="section5">
                    <div class="step-title">Ready to Sign</div>
                    <div class="step-description">Your promissory note is ready for signatures</div>
                    
                    <div style="text-align: center; padding: 40px 0;">
                        <div style="font-size: 48px; margin-bottom: 20px;">📝</div>
                        <p style="font-size: 18px; color: #6b7280; margin-bottom: 30px;">
                            Click below to proceed to the signing page where you can choose your preferred signing method.
                        </p>
                        
                        <button class="btn btn-primary" onclick="goToSigningPage()" style="font-size: 18px; padding: 16px 32px;">
                            Go to Signing Page
                        </button>
                        
                        <p style="font-size: 14px; color: #9ca3af; margin-top: 20px;">
                            You'll be able to choose between in-person signing or sending a remote invitation.
                        </p>
                    </div>
                </div>

            </div>

            <!-- Sidebar Preview -->
            <div class="sidebar">
                <div class="preview-title">Live Preview</div>
                
                <div class="preview-section">
                    <div class="preview-label">Principal Amount</div>
                    <div class="preview-value preview-amount" id="previewPrincipal">$0.00</div>
                </div>

                <div class="preview-section" id="previewFeeSection">
                    <div class="preview-label">Service Fee</div>
                    <div class="preview-value" id="previewFee">$0.00</div>
                </div>

                <div class="preview-section">
                    <div class="preview-label">Total Amount</div>
                    <div class="preview-value preview-amount" id="previewTotal">$0.00</div>
                </div>

                <div class="preview-section">
                    <div class="preview-label">Purpose</div>
                    <div class="preview-value" id="previewPurpose">Not specified</div>
                </div>

                <div class="preview-section">
                    <div class="preview-label">Due Date</div>
                    <div class="preview-value" id="previewDueDate">Not set</div>
                </div>

                <div class="preview-section">
                    <div class="preview-label">Payment Schedule</div>
                    <div class="preview-value" id="previewSchedule">Lump Sum</div>
                </div>

                <div class="preview-section hidden" id="previewLenderSection">
                    <div class="preview-label">Lender</div>
                    <div class="preview-value" id="previewLender">-</div>
                </div>

                <div class="preview-section hidden" id="previewBorrowerSection">
                    <div class="preview-label">Borrower</div>
                    <div class="preview-value" id="previewBorrower">-</div>
                </div>

                <!-- Progress indicator -->
                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #e5e7eb;">
                    <div style="font-size: 12px; color: #6b7280; margin-bottom: 8px;">Progress</div>
                    <div style="background: #e5e7eb; height: 6px; border-radius: 3px;">
                        <div id="sidebarProgress" style="background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); height: 100%; border-radius: 3px; width: 20%; transition: width 0.3s ease;"></div>
                    </div>
                    <div style="font-size: 11px; color: #9ca3af; margin-top: 4px;" id="progressText">Step 1 of 5</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 1;
        let currentPaymentSchedule = 'lump';

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadLenderInfo();
            updatePreview();
            setTodayAsLoanDate();
        });

        function setTodayAsLoanDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('loanDate').value = today;
        }

        function loadLenderInfo() {
            // Load lender info from localStorage (from profile page)
            const profile = JSON.parse(localStorage.getItem('userProfile') || '{}');
            if (profile.firstName) document.getElementById('lenderFirstName').value = profile.firstName;
            if (profile.lastName) document.getElementById('lenderLastName').value = profile.lastName;
            if (profile.email) document.getElementById('lenderEmail').value = profile.email;
            if (profile.phone) document.getElementById('lenderPhone').value = profile.phone;
            if (profile.address) document.getElementById('lenderAddress').value = profile.address;
            if (profile.city) document.getElementById('lenderCity').value = profile.city;
            if (profile.state) document.getElementById('lenderState').value = profile.state;
            if (profile.zip) document.getElementById('lenderZip').value = profile.zip;
            if (profile.county) document.getElementById('lenderCounty').value = profile.county;
        }

        function nextStep(step) {
            // Hide current section
            document.getElementById(`section${currentStep}`).classList.remove('active');
            document.getElementById(`step${currentStep}`).classList.remove('active');
            document.getElementById(`step${currentStep}`).classList.add('completed');
            
            // Show next section
            currentStep = step;
            document.getElementById(`section${currentStep}`).classList.add('active');
            document.getElementById(`step${currentStep}`).classList.add('active');
            
            // Update progress
            updateProgress();
            updatePreview();

            // Populate review if on step 4
            if (currentStep === 4) {
                populateReview();
            }
        }

        function prevStep(step) {
            // Hide current section
            document.getElementById(`section${currentStep}`).classList.remove('active');
            document.getElementById(`step${currentStep}`).classList.remove('active');
            
            // Show previous section
            document.getElementById(`step${currentStep}`).classList.add('completed');
            currentStep = step;
            document.getElementById(`section${currentStep}`).classList.add('active');
            document.getElementById(`step${currentStep}`).classList.remove('completed');
            document.getElementById(`step${currentStep}`).classList.add('active');
            
            // Update progress
            updateProgress();
        }

        function updateProgress() {
            const progressPercentage = (currentStep / 5) * 100;
            document.getElementById('progressLine').style.width = progressPercentage + '%';
            document.getElementById('sidebarProgress').style.width = progressPercentage + '%';
            document.getElementById('progressText').textContent = `Step ${currentStep} of 5`;
        }

        function selectPaymentSchedule(element, schedule) {
            // Update visual selection
            document.querySelectorAll('.radio-item').forEach(item => item.classList.remove('selected'));
            element.classList.add('selected');
            
            // Update payment schedule
            currentPaymentSchedule = schedule;
            
            // Show/hide breakdown
            const breakdown = document.getElementById('paymentBreakdown');
            if (schedule === 'lump') {
                breakdown.classList.remove('active');
            } else {
                breakdown.classList.add('active');
                calculatePaymentSchedule();
            }
            
            updatePreview();
        }

        function calculatePaymentSchedule() {
            const principal = parseFloat(document.getElementById('principalAmount').value) || 0;
            const serviceFee = parseFloat(document.getElementById('serviceFee').value) || 0;
            const interestRate = parseFloat(document.getElementById('interestRate').value) || 0;
            const loanDate = new Date(document.getElementById('loanDate').value || Date.now());
            const dueDate = new Date(document.getElementById('dueDate').value || Date.now());
            
            if (principal === 0 || !loanDate || !dueDate) return;
            
            const totalPrincipal = principal + serviceFee;
            const monthsToMaturity = Math.max(1, Math.ceil((dueDate - loanDate) / (1000 * 60 * 60 * 24 * 30.44)));
            
            let numberOfPayments, paymentFrequencyDays;
            
            switch(currentPaymentSchedule) {
                case 'monthly':
                    numberOfPayments = monthsToMaturity;
                    paymentFrequencyDays = 30.44;
                    break;
                case 'weekly':
                    numberOfPayments = Math.ceil(monthsToMaturity * 4.33);
                    paymentFrequencyDays = 7;
                    break;
                case 'biweekly':
                    numberOfPayments = Math.ceil(monthsToMaturity * 2.17);
                    paymentFrequencyDays = 14;
                    break;
                default:
                    return;
            }
            
            // Simple interest calculation
            const totalInterest = totalPrincipal * (interestRate / 100) * (monthsToMaturity / 12);
            const totalAmount = totalPrincipal + totalInterest;
            const paymentAmount = totalAmount / numberOfPayments;
            
            // Update display
            document.getElementById('paymentAmount').textContent = `$${paymentAmount.toFixed(2)}`;
            document.getElementById('numberOfPayments').textContent = numberOfPayments;
            document.getElementById('totalInterest').textContent = `$${totalInterest.toFixed(2)}`;
            document.getElementById('totalAmount').textContent = `$${totalAmount.toFixed(2)}`;
            
            // Generate payment table
            generatePaymentTable(loanDate, paymentAmount, numberOfPayments, paymentFrequencyDays, totalPrincipal, totalInterest);
        }

        function generatePaymentTable(startDate, paymentAmount, numberOfPayments, frequencyDays, principal, totalInterest) {
            const tableBody = document.getElementById('paymentScheduleTable');
            tableBody.innerHTML = '';
            
            let currentDate = new Date(startDate);
            let remainingPrincipal = principal;
            const interestPerPayment = totalInterest / numberOfPayments;
            const principalPerPayment = principal / numberOfPayments;
            
            for (let i = 1; i <= Math.min(numberOfPayments, 10); i++) { // Show max 10 payments
                currentDate = new Date(currentDate.getTime() + (frequencyDays * 24 * 60 * 60 * 1000));
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${i}</td>
                    <td>${currentDate.toLocaleDateString()}</td>
                    <td>$${paymentAmount.toFixed(2)}</td>
                    <td>$${principalPerPayment.toFixed(2)}</td>
                    <td>$${interestPerPayment.toFixed(2)}</td>
                `;
                tableBody.appendChild(row);
            }
            
            if (numberOfPayments > 10) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="5" style="text-align: center; font-style: italic; color: #666;">... and ${numberOfPayments - 10} more payments</td>`;
                tableBody.appendChild(row);
            }
        }

        function toggleUCCProvisions() {
            const enabled = document.getElementById('enableUCC').checked;
            const provisions = document.getElementById('uccProvisions');
            
            if (enabled) {
                provisions.classList.remove('hidden');
                updateVenueInfo();
            } else {
                provisions.classList.add('hidden');
            }
        }

        function updateVenueInfo() {
            const county = document.getElementById('lenderCounty').value || '[County]';
            const state = document.getElementById('lenderState').value || '[State]';
            document.getElementById('venueCounty').textContent = county;
            document.getElementById('venueState').textContent = state;
        }

        function populateReview() {
            // Loan summary
            const principal = parseFloat(document.getElementById('principalAmount').value) || 0;
            const serviceFee = parseFloat(document.getElementById('serviceFee').value) || 0;
            const interestRate = parseFloat(document.getElementById('interestRate').value) || 0;
            const lateFee = parseFloat(document.getElementById('lateFee').value) || 0;
            const gracePeriod = parseInt(document.getElementById('gracePeriod').value) || 0;
            
            document.getElementById('reviewPrincipal').textContent = `$${principal.toFixed(2)}`;
            document.getElementById('reviewServiceFee').textContent = `$${serviceFee.toFixed(2)}`;
            document.getElementById('reviewInterestRate').textContent = `${interestRate}%`;
            document.getElementById('reviewTotalAmount').textContent = `$${(principal + serviceFee).toFixed(2)}`;
            document.getElementById('reviewPaymentSchedule').textContent = 
                currentPaymentSchedule.charAt(0).toUpperCase() + currentPaymentSchedule.slice(1);
            document.getElementById('reviewLateFee').textContent = `$${lateFee.toFixed(2)}`;
            document.getElementById('reviewGracePeriod').textContent = `${gracePeriod} days`;
            
            // Parties
            const lenderName = `${document.getElementById('lenderFirstName').value} ${document.getElementById('lenderLastName').value}`.trim();
            const borrowerName = `${document.getElementById('borrowerFirstName').value} ${document.getElementById('borrowerLastName').value}`.trim();
            const venue = `${document.getElementById('lenderCounty').value || '[County]'}, ${document.getElementById('lenderState').value || '[State]'}`;
            
            document.getElementById('reviewLender').textContent = lenderName || '-';
            document.getElementById('reviewBorrower').textContent = borrowerName || '-';
            document.getElementById('reviewVenue').textContent = venue;
            
            // UCC
            const uccEnabled = document.getElementById('enableUCC').checked;
            document.getElementById('reviewUCC').textContent = uccEnabled ? 'Enabled' : 'Not Enabled';
        }

        function proceedToSigning() {
            // Save contract data to localStorage for signing page
            const contractData = {
                principal: document.getElementById('principalAmount').value,
                serviceFee: document.getElementById('serviceFee').value,
                interestRate: document.getElementById('interestRate').value,
                loanDate: document.getElementById('loanDate').value,
                dueDate: document.getElementById('dueDate').value,
                purpose: document.getElementById('purpose').value,
                paymentSchedule: currentPaymentSchedule,
                lateFee: document.getElementById('lateFee').value,
                gracePeriod: document.getElementById('gracePeriod').value,
                lender: {
                    firstName: document.getElementById('lenderFirstName').value,
                    lastName: document.getElementById('lenderLastName').value,
                    email: document.getElementById('lenderEmail').value,
                    phone: document.getElementById('lenderPhone').value,
                    address: document.getElementById('lenderAddress').value,
                    city: document.getElementById('lenderCity').value,
                    state: document.getElementById('lenderState').value,
                    zip: document.getElementById('lenderZip').value,
                    county: document.getElementById('lenderCounty').value
                },
                borrower: {
                    firstName: document.getElementById('borrowerFirstName').value,
                    lastName: document.getElementById('borrowerLastName').value,
                    email: document.getElementById('borrowerEmail').value,
                    phone: document.getElementById('borrowerPhone').value,
                    address: document.getElementById('borrowerAddress').value,
                    city: document.getElementById('borrowerCity').value,
                    state: document.getElementById('borrowerState').value,
                    zip: document.getElementById('borrowerZip').value,
                    ssn: document.getElementById('borrowerSSN').value
                },
                uccEnabled: document.getElementById('enableUCC').checked,
                createdDate: new Date().toISOString()
            };
            
            localStorage.setItem('pendingContract', JSON.stringify(contractData));
            nextStep(5);
        }

        function goToSigningPage() {
            // Redirect to your existing signing page
            window.location.href = 'sign-contract-flexible.html';
        }

        function updatePreview() {
            const principal = parseFloat(document.getElementById('principalAmount').value) || 0;
            const fee = parseFloat(document.getElementById('serviceFee').value) || 0;
            const total = principal + fee;
            const purpose = document.getElementById('purpose').value;
            const dueDate = document.getElementById('dueDate').value;
            
            document.getElementById('previewPrincipal').textContent = '$' + principal.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            document.getElementById('previewTotal').textContent = '$' + total.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            
            if (fee > 0) {
                document.getElementById('previewFee').textContent = '$' + fee.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                document.getElementById('previewFeeSection').classList.remove('hidden');
            } else {
                document.getElementById('previewFeeSection').classList.add('hidden');
            }
            
            document.getElementById('previewPurpose').textContent = purpose ? 
                purpose.charAt(0).toUpperCase() + purpose.slice(1).replace('_', ' ') : 'Not specified';
            document.getElementById('previewDueDate').textContent = dueDate ? 
                new Date(dueDate + 'T00:00:00').toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }) : 'Not set';
            document.getElementById('previewSchedule').textContent = 
                currentPaymentSchedule.charAt(0).toUpperCase() + currentPaymentSchedule.slice(1);
            
            // Update parties
            const lenderFirst = document.getElementById('lenderFirstName').value;
            const lenderLast = document.getElementById('lenderLastName').value;
            const borrowerFirst = document.getElementById('borrowerFirstName').value;
            const borrowerLast = document.getElementById('borrowerLastName').value;
            
            if (lenderFirst && lenderLast) {
                document.getElementById('previewLender').textContent = lenderFirst + ' ' + lenderLast;
                document.getElementById('previewLenderSection').classList.remove('hidden');
            }
            
            if (borrowerFirst && borrowerLast) {
                document.getElementById('previewBorrower').textContent = borrowerFirst + ' ' + borrowerLast;
                document.getElementById('previewBorrowerSection').classList.remove('hidden');
            }
        }

        function saveDraft() {
            const formData = {
                principalAmount: document.getElementById('principalAmount').value,
                serviceFee: document.getElementById('serviceFee').value,
                loanDate: document.getElementById('loanDate').value,
                dueDate: document.getElementById('dueDate').value,
                purpose: document.getElementById('purpose').value,
                paymentSchedule: currentPaymentSchedule,
                currentStep: currentStep
            };
            localStorage.setItem('trustlend_draft', JSON.stringify(formData));
            alert('Draft saved! You can continue editing later.');
        }

        // Auto-update preview as user types
        document.addEventListener('input', function(e) {
            updatePreview();
            if (currentPaymentSchedule !== 'lump') {
                calculatePaymentSchedule();
            }
            if (e.target.id === 'lenderCounty' || e.target.id === 'lenderState') {
                updateVenueInfo();
            }
        });

        // Auto-update when payment schedule changes
        document.addEventListener('change', function(e) {
            if (e.target.name === 'paymentSchedule') {
                updatePreview();
            }
        });
    </script>
</body>
</html>
