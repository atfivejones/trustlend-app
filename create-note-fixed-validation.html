<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Promissory Note - TrustLend</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: white;
            padding: 24px 30px;
            border-bottom: 2px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            color: #1a1a1a;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            font-weight: 700;
        }

        .logo-text {
            font-size: 24px;
            font-weight: 700;
            color: #1a1a1a;
        }

        .header-actions {
            display: flex;
            gap: 16px;
        }

        .header-btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header-btn.secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .header-btn.secondary:hover {
            background: #f8f9ff;
        }

        .progress-container {
            padding: 40px 30px 30px;
            background: #fafafa;
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            position: relative;
        }

        .progress-line {
            position: absolute;
            top: 20px;
            left: 40px;
            right: 40px;
            height: 3px;
            background: #e0e0e0;
            z-index: 0;
        }

        .progress-line-active {
            position: absolute;
            top: 20px;
            left: 40px;
            height: 3px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            z-index: 1;
            transition: width 0.3s ease;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: 3px solid #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: #999;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .step.active .step-number {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: white;
            transform: scale(1.1);
        }

        .step.completed .step-number {
            background: #10b981;
            border-color: #10b981;
            color: white;
        }

        .step-label {
            font-size: 13px;
            color: #666;
            font-weight: 500;
            white-space: nowrap;
        }

        .step.active .step-label {
            color: #667eea;
            font-weight: 600;
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            padding: 40px;
        }

        .main-content {
            min-height: 500px;
        }

        .step-title {
            font-size: 28px;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 8px;
        }

        .step-description {
            font-size: 16px;
            color: #666;
            margin-bottom: 30px;
        }

        .form-section {
            display: none;
        }

        .form-section.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form-card {
            background: #fafafa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 20px;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .label-optional {
            font-weight: 400;
            color: #999;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 15px;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
            background: white;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .input-prefix {
            position: relative;
        }

        .input-prefix input {
            padding-left: 35px;
        }

        .prefix-symbol {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            font-weight: 600;
        }

        .help-text {
            font-size: 13px;
            color: #666;
            margin-top: 6px;
        }

        .checkbox-group {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 16px;
            background: white;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checkbox-group:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-top: 2px;
            cursor: pointer;
        }

        .checkbox-label {
            flex: 1;
            font-size: 14px;
            color: #333;
            line-height: 1.5;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #f0f0f0;
        }

        .btn {
            padding: 14px 32px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-family: 'Inter', sans-serif;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            flex: 1;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            padding: 12px 32px;
        }

        .btn-secondary:hover {
            background: #f8f9ff;
        }

        /* Signature Pad */
        .signature-section {
            margin-top: 20px;
        }

        .signature-methods {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .method-btn {
            padding: 8px 16px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .method-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .signature-canvas-container {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            padding: 20px;
            margin-bottom: 15px;
        }

        .signature-canvas {
            width: 100%;
            height: 150px;
            border: 2px dashed #d0d0d0;
            border-radius: 8px;
            cursor: crosshair;
            background: #fafafa;
        }

        .signature-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .btn-small {
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }

        .btn-clear {
            background: #fee2e2;
            color: #dc2626;
        }

        .btn-clear:hover {
            background: #fecaca;
        }

        .typed-signature-input {
            font-family: 'Brush Script MT', cursive;
            font-size: 32px;
            text-align: center;
            padding: 20px;
        }

        /* OTP Input */
        .otp-container {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }

        .otp-input {
            width: 50px;
            height: 60px;
            text-align: center;
            font-size: 24px;
            font-weight: 700;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
        }

        .otp-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        /* Preview Sidebar */
        .preview-sidebar {
            position: sticky;
            top: 20px;
            height: fit-content;
        }

        .preview-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 30px;
        }

        .preview-title {
            font-size: 18px;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 20px;
        }

        .preview-item {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #f0f0f0;
        }

        .preview-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .preview-label {
            font-size: 12px;
            color: #666;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }

        .preview-value {
            font-size: 16px;
            color: #1a1a1a;
            font-weight: 600;
        }

        .preview-value.large {
            font-size: 24px;
            color: #667eea;
        }

        /* Success Animation */
        .success-animation {
            text-align: center;
            padding: 60px 20px;
        }

        .success-icon {
            width: 100px;
            height: 100px;
            background: #10b981;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 30px;
            font-size: 50px;
            animation: successPop 0.5s ease;
        }

        @keyframes successPop {
            0% {
                transform: scale(0);
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
            }
        }

        .success-title {
            font-size: 32px;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 16px;
        }

        .success-message {
            font-size: 18px;
            color: #666;
            margin-bottom: 40px;
            line-height: 1.6;
        }

        .info-box {
            background: #f0f9ff;
            border: 2px solid #bfdbfe;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .info-box-title {
            font-size: 14px;
            font-weight: 700;
            color: #1e40af;
            margin-bottom: 8px;
        }

        .info-box-text {
            font-size: 13px;
            color: #1e3a8a;
            line-height: 1.5;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .content {
                grid-template-columns: 1fr;
            }

            .preview-sidebar {
                position: relative;
                top: 0;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 0;
            }

            .container {
                border-radius: 0;
                min-height: 100vh;
            }

            .header {
                padding: 16px 20px;
                flex-direction: column;
                gap: 16px;
            }

            .content {
                padding: 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .step-label {
                font-size: 11px;
            }

            .otp-input {
                width: 40px;
                height: 50px;
                font-size: 20px;
            }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="index.html" class="logo">
                <div class="logo-icon">T</div>
                <span class="logo-text">TrustLend</span>
            </a>
            <div class="header-actions">
                <button class="header-btn secondary" onclick="saveDraft()">
                    üíæ Save Draft
                </button>
                <a href="dashboard.html" class="header-btn secondary">
                    ‚úï Cancel
                </a>
            </div>
        </div>

        <div class="progress-container">
            <div class="progress-steps">
                <div class="progress-line"></div>
                <div class="progress-line-active" id="progressLineActive" style="width: 0%"></div>
                
                <div class="step active" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-label">Loan Details</div>
                </div>
                <div class="step" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-label">Parties Info</div>
                </div>
                <div class="step" data-step="3">
                    <div class="step-number">3</div>
                    <div class="step-label">Terms</div>
                </div>
                <div class="step" data-step="4">
                    <div class="step-number">4</div>
                    <div class="step-label">Signatures</div>
                </div>
                <div class="step" data-step="5">
                    <div class="step-number">5</div>
                    <div class="step-label">Complete</div>
                </div>
            </div>
        </div>

        <div class="content">
            <div class="main-content">
                <!-- Step 1: Loan Details -->
                <div class="form-section active" id="step1">
                    <h2 class="step-title">Loan Details</h2>
                    <p class="step-description">Enter the basic loan information and terms</p>

                    <div class="form-card">
                        <h3 class="card-title">Amount & Dates</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="principalAmount">Principal Amount</label>
                                <div class="input-prefix">
                                    <span class="prefix-symbol">$</span>
                                    <input type="number" id="principalAmount" placeholder="5000" oninput="updatePreview()">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="serviceFee">Service Fee <span class="label-optional">(Optional)</span></label>
                                <div class="input-prefix">
                                    <span class="prefix-symbol">$</span>
                                    <input type="number" id="serviceFee" placeholder="0" oninput="updatePreview()">
                                </div>
                                <div class="help-text">One-time flat fee added to principal</div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="loanDate">Loan Date</label>
                                <input type="date" id="loanDate" oninput="updatePreview()">
                            </div>
                            <div class="form-group">
                                <label for="dueDate">Due Date</label>
                                <input type="date" id="dueDate" oninput="updatePreview()">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="purpose">Loan Purpose</label>
                            <select id="purpose" oninput="updatePreview()">
                                <option value="">Select purpose...</option>
                                <option value="personal">Personal Expense</option>
                                <option value="medical">Medical Bills</option>
                                <option value="education">Education</option>
                                <option value="business">Business Investment</option>
                                <option value="home">Home Improvement</option>
                                <option value="vehicle">Vehicle Purchase</option>
                                <option value="other">Other</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="paymentSchedule">Payment Schedule</label>
                            <select id="paymentSchedule" oninput="updatePreview()">
                                <option value="lump_sum">Lump Sum (One Payment)</option>
                                <option value="monthly">Monthly Payments</option>
                                <option value="biweekly">Bi-weekly Payments</option>
                                <option value="weekly">Weekly Payments</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-card">
                        <h3 class="card-title">Late Fee Terms <span class="label-optional">(Optional)</span></h3>
                        
                        <div class="checkbox-group" style="margin-bottom: 20px;">
                            <input type="checkbox" id="enableLateFee" onchange="toggleLateFee()">
                            <label for="enableLateFee" class="checkbox-label">
                                <strong>Enable Late Fee</strong><br>
                                Charge a fee if payment is late
                            </label>
                        </div>

                        <div id="lateFeeOptions" class="hidden">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Late Fee Type</label>
                                    <select id="lateFeeType">
                                        <option value="percentage">Percentage</option>
                                        <option value="flat">Flat Amount</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="lateFeeAmount">Amount</label>
                                    <input type="number" id="lateFeeAmount" placeholder="5" value="5">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="gracePeriod">Grace Period (Days)</label>
                                <input type="number" id="gracePeriod" placeholder="15" value="15">
                                <div class="help-text">Number of days after due date before late fee applies</div>
                            </div>
                        </div>
                    </div>

                    <div class="button-group">
                        <button class="btn btn-primary" onclick="nextStep()">Next: Parties Information</button>
                    </div>
                </div>

                <!-- Step 2: Parties Information -->
                <div class="form-section" id="step2">
                    <h2 class="step-title">Parties Information</h2>
                    <p class="step-description">Enter details for lender and borrower</p>

                    <div class="form-card">
                        <h3 class="card-title">Lender Information (You)</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="lenderFirstName">First Name</label>
                                <input type="text" id="lenderFirstName" placeholder="John" oninput="updatePreview()">
                            </div>
                            <div class="form-group">
                                <label for="lenderLastName">Last Name</label>
                                <input type="text" id="lenderLastName" placeholder="Doe" oninput="updatePreview()">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="lenderEmail">Email</label>
                                <input type="email" id="lenderEmail" placeholder="john@example.com" oninput="updatePreview()">
                            </div>
                            <div class="form-group">
                                <label for="lenderPhone">Phone</label>
                                <input type="tel" id="lenderPhone" placeholder="(555) 123-4567" oninput="formatPhone(this); updatePreview()">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="lenderStreet">Street Address</label>
                            <input type="text" id="lenderStreet" placeholder="123 Main St" oninput="updatePreview()">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="lenderCity">City</label>
                                <input type="text" id="lenderCity" placeholder="Atlanta" oninput="updatePreview()">
                            </div>
                            <div class="form-group">
                                <label for="lenderState">State</label>
                                <select id="lenderState" oninput="updatePreview()">
                                    <option value="">Select state...</option>
                                    <option value="AL">Alabama</option>
                                    <option value="AK">Alaska</option>
                                    <option value="AZ">Arizona</option>
                                    <option value="AR">Arkansas</option>
                                    <option value="CA">California</option>
                                    <option value="CO">Colorado</option>
                                    <option value="CT">Connecticut</option>
                                    <option value="DE">Delaware</option>
                                    <option value="FL">Florida</option>
                                    <option value="GA">Georgia</option>
                                    <option value="HI">Hawaii</option>
                                    <option value="ID">Idaho</option>
                                    <option value="IL">Illinois</option>
                                    <option value="IN">Indiana</option>
                                    <option value="IA">Iowa</option>
                                    <option value="KS">Kansas</option>
                                    <option value="KY">Kentucky</option>
                                    <option value="LA">Louisiana</option>
                                    <option value="ME">Maine</option>
                                    <option value="MD">Maryland</option>
                                    <option value="MA">Massachusetts</option>
                                    <option value="MI">Michigan</option>
                                    <option value="MN">Minnesota</option>
                                    <option value="MS">Mississippi</option>
                                    <option value="MO">Missouri</option>
                                    <option value="MT">Montana</option>
                                    <option value="NE">Nebraska</option>
                                    <option value="NV">Nevada</option>
                                    <option value="NH">New Hampshire</option>
                                    <option value="NJ">New Jersey</option>
                                    <option value="NM">New Mexico</option>
                                    <option value="NY">New York</option>
                                    <option value="NC">North Carolina</option>
                                    <option value="ND">North Dakota</option>
                                    <option value="OH">Ohio</option>
                                    <option value="OK">Oklahoma</option>
                                    <option value="OR">Oregon</option>
                                    <option value="PA">Pennsylvania</option>
                                    <option value="RI">Rhode Island</option>
                                    <option value="SC">South Carolina</option>
                                    <option value="SD">South Dakota</option>
                                    <option value="TN">Tennessee</option>
                                    <option value="TX">Texas</option>
                                    <option value="UT">Utah</option>
                                    <option value="VT">Vermont</option>
                                    <option value="VA">Virginia</option>
                                    <option value="WA">Washington</option>
                                    <option value="WV">West Virginia</option>
                                    <option value="WI">Wisconsin</option>
                                    <option value="WY">Wyoming</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="lenderZip">ZIP Code</label>
                                <input type="text" id="lenderZip" placeholder="30301" maxlength="5" oninput="updatePreview()">
                            </div>
                            <div class="form-group">
                                <label for="lenderCounty">County</label>
                                <input type="text" id="lenderCounty" placeholder="Fulton" oninput="updatePreview()">
                            </div>
                        </div>
                    </div>

                    <div class="form-card">
                        <h3 class="card-title">Borrower Information</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="borrowerFirstName">First Name</label>
                                <input type="text" id="borrowerFirstName" placeholder="Jane" oninput="updatePreview()">
                            </div>
                            <div class="form-group">
                                <label for="borrowerLastName">Last Name</label>
                                <input type="text" id="borrowerLastName" placeholder="Smith" oninput="updatePreview()">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="borrowerEmail">Email</label>
                                <input type="email" id="borrowerEmail" placeholder="jane@example.com" oninput="updatePreview()">
                            </div>
                            <div class="form-group">
                                <label for="borrowerPhone">Phone</label>
                                <input type="tel" id="borrowerPhone" placeholder="(555) 987-6543" oninput="formatPhone(this); updatePreview()">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="borrowerStreet">Street Address</label>
                            <input type="text" id="borrowerStreet" placeholder="456 Oak Ave" oninput="updatePreview()">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="borrowerCity">City</label>
                                <input type="text" id="borrowerCity" placeholder="Atlanta" oninput="updatePreview()">
                            </div>
                            <div class="form-group">
                                <label for="borrowerState">State</label>
                                <select id="borrowerState" oninput="updatePreview()">
                                    <option value="">Select state...</option>
                                    <option value="GA">Georgia</option>
                                    <option value="AL">Alabama</option>
                                    <option value="FL">Florida</option>
                                    <!-- Add more states as needed -->
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="borrowerZip">ZIP Code</label>
                            <input type="text" id="borrowerZip" placeholder="30302" maxlength="5" oninput="updatePreview()">
                        </div>
                    </div>

                    <div class="button-group">
                        <button class="btn btn-secondary" onclick="prevStep()">Back</button>
                        <button class="btn btn-primary" onclick="nextStep()">Next: Additional Terms</button>
                    </div>
                </div>

                <!-- Step 3: Additional Terms -->
                <div class="form-section" id="step3">
                    <h2 class="step-title">Additional Terms</h2>
                    <p class="step-description">Configure optional terms and conditions</p>

                    <div class="form-card">
                        <h3 class="card-title">Interest & Penalties</h3>
                        
                        <div class="form-group">
                            <label for="interestRate">Annual Interest Rate (%) <span class="label-optional">(Optional)</span></label>
                            <input type="number" id="interestRate" placeholder="0" step="0.1" oninput="updatePreview()">
                            <div class="help-text">Leave at 0 for interest-free loan</div>
                        </div>

                        <div class="checkbox-group">
                            <input type="checkbox" id="accelerationClause">
                            <label for="accelerationClause" class="checkbox-label">
                                <strong>Acceleration Clause</strong><br>
                                If borrower defaults, entire balance becomes immediately due
                            </label>
                        </div>
                    </div>

                    <div class="form-card">
                        <h3 class="card-title">Collateral <span class="label-optional">(Optional)</span></h3>
                        
                        <div class="checkbox-group" style="margin-bottom: 20px;">
                            <input type="checkbox" id="hasCollateral" onchange="toggleCollateral()">
                            <label for="hasCollateral" class="checkbox-label">
                                <strong>This loan is secured by collateral</strong>
                            </label>
                        </div>

                        <div id="collateralDetails" class="hidden">
                            <div class="form-group">
                                <label for="collateralDescription">Collateral Description</label>
                                <textarea id="collateralDescription" placeholder="Describe the collateral securing this loan (e.g., 2020 Honda Civic, VIN: 123456789)"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="button-group">
                        <button class="btn btn-secondary" onclick="prevStep()">Back</button>
                        <button class="btn btn-primary" onclick="nextStep()">Next: Digital Signatures</button>
                    </div>
                </div>

                <!-- Step 4: Signatures -->
                <div class="form-section" id="step4">
                    <h2 class="step-title">Digital Signatures</h2>
                    <p class="step-description">Sign the contract digitally with identity verification</p>

                    <div class="info-box">
                        <div class="info-box-title">üîí Secure Digital Signing</div>
                        <div class="info-box-text">
                            Your signatures are legally binding and will be verified through OTP sent to the provided email addresses.
                            Both parties must sign to complete the contract.
                        </div>
                    </div>

                    <!-- Lender Signature -->
                    <div class="form-card">
                        <h3 class="card-title">Lender Signature (Your Signature)</h3>
                        
                        <div class="signature-methods">
                            <button class="method-btn active" onclick="setSignatureMethod('lender', 'draw')">‚úçÔ∏è Draw</button>
                            <button class="method-btn" onclick="setSignatureMethod('lender', 'type')">‚å®Ô∏è Type</button>
                        </div>

                        <div id="lenderDrawMethod">
                            <div class="signature-canvas-container">
                                <canvas id="lenderCanvas" class="signature-canvas"></canvas>
                                <div class="signature-controls">
                                    <button class="btn-small btn-clear" onclick="clearSignature('lender')">Clear</button>
                                </div>
                            </div>
                        </div>

                        <div id="lenderTypeMethod" class="hidden">
                            <input type="text" id="lenderTypedName" class="typed-signature-input" placeholder="Type your full name" oninput="updateTypedSignature('lender')">
                            <div class="help-text">Your typed name will appear as your signature</div>
                        </div>

                        <div class="form-group" style="margin-top: 20px;">
                            <button class="btn btn-primary" onclick="verifyLenderSignature()" id="verifyLenderBtn">
                                Verify & Sign
                            </button>
                        </div>

                        <div id="lenderOtpSection" class="hidden" style="margin-top: 20px;">
                            <label>Enter OTP sent to your email</label>
                            <div class="otp-container">
                                <input type="text" class="otp-input" maxlength="1" oninput="moveToNext(this, 1)">
                                <input type="text" class="otp-input" maxlength="1" oninput="moveToNext(this, 2)">
                                <input type="text" class="otp-input" maxlength="1" oninput="moveToNext(this, 3)">
                                <input type="text" class="otp-input" maxlength="1" oninput="moveToNext(this, 4)">
                                <input type="text" class="otp-input" maxlength="1" oninput="moveToNext(this, 5)">
                                <input type="text" class="otp-input" maxlength="1" oninput="moveToNext(this, 6)">
                            </div>
                            <button class="btn btn-primary" onclick="confirmLenderOtp()">Confirm OTP</button>
                            <div class="help-text" style="text-align: center; margin-top: 10px;">
                                Didn't receive code? <a href="#" onclick="resendOtp('lender'); return false;" style="color: #667eea; font-weight: 600;">Resend</a>
                            </div>
                        </div>

                        <div id="lenderSignedConfirm" class="hidden">
                            <div class="info-box" style="background: #d1fae5; border-color: #6ee7b7;">
                                <div class="info-box-title" style="color: #065f46;">‚úì Signature Verified</div>
                                <div class="info-box-text" style="color: #047857;">
                                    Your signature has been verified and recorded.
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Borrower Signature -->
                    <div class="form-card">
                        <h3 class="card-title">Borrower Signature</h3>
                        
                        <div class="checkbox-group" style="margin-bottom: 20px;">
                            <input type="checkbox" id="collectBorrowerNow" onchange="toggleBorrowerSignature()">
                            <label for="collectBorrowerNow" class="checkbox-label">
                                <strong>Collect borrower signature now</strong><br>
                                Check this if the borrower is present and can sign immediately
                            </label>
                        </div>

                        <div id="borrowerSignatureSection" class="hidden">
                            <div class="signature-methods">
                                <button class="method-btn active" onclick="setSignatureMethod('borrower', 'draw')">‚úçÔ∏è Draw</button>
                                <button class="method-btn" onclick="setSignatureMethod('borrower', 'type')">‚å®Ô∏è Type</button>
                            </div>

                            <div id="borrowerDrawMethod">
                                <div class="signature-canvas-container">
                                    <canvas id="borrowerCanvas" class="signature-canvas"></canvas>
                                    <div class="signature-controls">
                                        <button class="btn-small btn-clear" onclick="clearSignature('borrower')">Clear</button>
                                    </div>
                                </div>
                            </div>

                            <div id="borrowerTypeMethod" class="hidden">
                                <input type="text" id="borrowerTypedName" class="typed-signature-input" placeholder="Type full name" oninput="updateTypedSignature('borrower')">
                            </div>

                            <div class="form-group" style="margin-top: 20px;">
                                <button class="btn btn-primary" onclick="verifyBorrowerSignature()" id="verifyBorrowerBtn">
                                    Verify Borrower Signature
                                </button>
                            </div>

                            <div id="borrowerOtpSection" class="hidden" style="margin-top: 20px;">
                                <label>Enter OTP sent to borrower's email</label>
                                <div class="otp-container">
                                    <input type="text" class="otp-input" maxlength="1" oninput="moveToNext(this, 1)">
                                    <input type="text" class="otp-input" maxlength="1" oninput="moveToNext(this, 2)">
                                    <input type="text" class="otp-input" maxlength="1" oninput="moveToNext(this, 3)">
                                    <input type="text" class="otp-input" maxlength="1" oninput="moveToNext(this, 4)">
                                    <input type="text" class="otp-input" maxlength="1" oninput="moveToNext(this, 5)">
                                    <input type="text" class="otp-input" maxlength="1" oninput="moveToNext(this, 6)">
                                </div>
                                <button class="btn btn-primary" onclick="confirmBorrowerOtp()">Confirm OTP</button>
                            </div>

                            <div id="borrowerSignedConfirm" class="hidden">
                                <div class="info-box" style="background: #d1fae5; border-color: #6ee7b7;">
                                    <div class="info-box-title" style="color: #065f46;">‚úì Borrower Signature Verified</div>
                                    <div class="info-box-text" style="color: #047857;">
                                        Borrower signature has been verified and recorded.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="borrowerInviteInfo" class="info-box">
                            <div class="info-box-title">üìß Send Signature Request</div>
                            <div class="info-box-text">
                                After you sign, an email with a secure signing link will be sent to the borrower at <strong id="borrowerEmailPreview">their email</strong>.
                                They will receive OTP verification before signing.
                            </div>
                        </div>
                    </div>

                    <div class="form-card">
                        <div class="checkbox-group">
                            <input type="checkbox" id="agreeTerms">
                            <label for="agreeTerms" class="checkbox-label">
                                <strong>I confirm that all information is accurate</strong><br>
                                I understand this creates a legally binding promissory note. Both parties will need to sign digitally and verify their identities to complete the contract.
                            </label>
                        </div>
                    </div>

                    <div class="button-group">
                        <button class="btn btn-secondary" onclick="prevStep()">Back</button>
                        <button class="btn btn-primary" onclick="generateContract()" id="generateBtn" disabled>
                            Generate Contract
                        </button>
                    </div>
                </div>

                <!-- Step 5: Success -->
                <div class="form-section" id="step5">
                    <div class="success-animation">
                        <div class="success-icon">‚úì</div>
                        <h2 class="success-title">Contract Created Successfully!</h2>
                        <p class="success-message">
                            Your promissory note has been generated and saved. 
                            <span id="borrowerStatusMessage"></span>
                        </p>

                        <div class="info-box" style="text-align: left; max-width: 500px; margin: 0 auto 30px;">
                            <div class="info-box-title">üìã Next Steps</div>
                            <div class="info-box-text">
                                <ul style="margin-left: 20px; line-height: 2;">
                                    <li id="nextStep1">Contract saved to your dashboard</li>
                                    <li id="nextStep2">Email sent to borrower with signing link</li>
                                    <li id="nextStep3">Blockchain timestamp will be added after final signature</li>
                                    <li id="nextStep4">Both parties will receive final PDF copy</li>
                                </ul>
                            </div>
                        </div>

                        <div style="display: flex; gap: 15px; justify-content: center;">
                            <button class="btn btn-primary" onclick="window.location.href='dashboard.html'">
                                View Dashboard
                            </button>
                            <button class="btn btn-secondary" onclick="window.location.href='create-note-fixed-validation.html'">
                                Create Another Contract
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Preview Sidebar -->
            <div class="preview-sidebar">
                <div class="preview-card">
                    <h3 class="preview-title">Contract Preview</h3>
                    
                    <div class="preview-item">
                        <div class="preview-label">Total Amount</div>
                        <div class="preview-value large" id="previewTotal">$0.00</div>
                    </div>

                    <div class="preview-item">
                        <div class="preview-label">Principal</div>
                        <div class="preview-value" id="previewPrincipal">$0.00</div>
                    </div>

                    <div class="preview-item" id="previewFeeSection" class="hidden">
                        <div class="preview-label">Service Fee</div>
                        <div class="preview-value" id="previewFee">$0.00</div>
                    </div>

                    <div class="preview-item">
                        <div class="preview-label">Purpose</div>
                        <div class="preview-value" id="previewPurpose">Not specified</div>
                    </div>

                    <div class="preview-item">
                        <div class="preview-label">Due Date</div>
                        <div class="preview-value" id="previewDueDate">Not set</div>
                    </div>

                    <div class="preview-item">
                        <div class="preview-label">Payment Schedule</div>
                        <div class="preview-value" id="previewSchedule">Not selected</div>
                    </div>

                    <div class="preview-item" id="previewLenderSection" class="hidden">
                        <div class="preview-label">Lender</div>
                        <div class="preview-value" id="previewLender">-</div>
                    </div>

                    <div class="preview-item" id="previewBorrowerSection" class="hidden">
                        <div class="preview-label">Borrower</div>
                        <div class="preview-value" id="previewBorrower">-</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 1;
        const totalSteps = 5;
        let lenderSigned = false;
        let borrowerSigned = false;
        let lenderSignatureMethod = 'draw';
        let borrowerSignatureMethod = 'draw';
        let lenderCanvas, lenderCtx;
        let borrowerCanvas, borrowerCtx;
        let isDrawing = false;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateProgress();
            setDefaultDates();
            initializeCanvases();
        });

        function setDefaultDates() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('loanDate').value = today;
            
            const oneMonthLater = new Date();
            oneMonthLater.setMonth(oneMonthLater.getMonth() + 1);
            document.getElementById('dueDate').value = oneMonthLater.toISOString().split('T')[0];
            
            updatePreview();
        }

        function initializeCanvases() {
            // Lender canvas
            lenderCanvas = document.getElementById('lenderCanvas');
            if (lenderCanvas) {
                lenderCtx = lenderCanvas.getContext('2d');
                lenderCanvas.width = lenderCanvas.offsetWidth;
                lenderCanvas.height = 150;
                setupCanvas(lenderCanvas, lenderCtx);
            }

            // Borrower canvas
            borrowerCanvas = document.getElementById('borrowerCanvas');
            if (borrowerCanvas) {
                borrowerCtx = borrowerCanvas.getContext('2d');
                borrowerCanvas.width = borrowerCanvas.offsetWidth;
                borrowerCanvas.height = 150;
                setupCanvas(borrowerCanvas, borrowerCtx);
            }
        }

        function setupCanvas(canvas, ctx) {
            let drawing = false;
            let lastX = 0;
            let lastY = 0;

            canvas.addEventListener('mousedown', (e) => {
                drawing = true;
                [lastX, lastY] = [e.offsetX, e.offsetY];
            });

            canvas.addEventListener('mousemove', (e) => {
                if (!drawing) return;
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 2;
                ctx.lineCap = 'round';
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(e.offsetX, e.offsetY);
                ctx.stroke();
                [lastX, lastY] = [e.offsetX, e.offsetY];
            });

            canvas.addEventListener('mouseup', () => drawing = false);
            canvas.addEventListener('mouseout', () => drawing = false);

            // Touch events
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                drawing = true;
                const rect = canvas.getBoundingClientRect();
                const touch = e.touches[0];
                lastX = touch.clientX - rect.left;
                lastY = touch.clientY - rect.top;
            });

            canvas.addEventListener('touchmove', (e) => {
                if (!drawing) return;
                e.preventDefault();
                const rect = canvas.getBoundingClientRect();
                const touch = e.touches[0];
                const x = touch.clientX - rect.left;
                const y = touch.clientY - rect.top;
                
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 2;
                ctx.lineCap = 'round';
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(x, y);
                ctx.stroke();
                [lastX, lastY] = [x, y];
            });

            canvas.addEventListener('touchend', () => drawing = false);
        }

        function nextStep() {
            if (!validateStep(currentStep)) return;
            
            if (currentStep < totalSteps) {
                document.getElementById('step' + currentStep).classList.remove('active');
                currentStep++;
                document.getElementById('step' + currentStep).classList.add('active');
                updateProgress();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                document.getElementById('step' + currentStep).classList.remove('active');
                currentStep--;
                document.getElementById('step' + currentStep).classList.add('active');
                updateProgress();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function validateStep(step) {
            if (step === 1) {
                const principal = document.getElementById('principalAmount').value;
                const loanDate = document.getElementById('loanDate').value;
                const dueDate = document.getElementById('dueDate').value;
                
                if (!principal || parseFloat(principal) <= 0) {
                    alert('Please enter a valid principal amount');
                    return false;
                }
                if (!loanDate || !dueDate) {
                    alert('Please select both loan date and due date');
                    return false;
                }
                if (new Date(dueDate) <= new Date(loanDate)) {
                    alert('Due date must be after loan date');
                    return false;
                }
            } else if (step === 2) {
                const lenderFirst = document.getElementById('lenderFirstName').value;
                const lenderLast = document.getElementById('lenderLastName').value;
                const lenderEmail = document.getElementById('lenderEmail').value;
                const borrowerFirst = document.getElementById('borrowerFirstName').value;
                const borrowerLast = document.getElementById('borrowerLastName').value;
                const borrowerEmail = document.getElementById('borrowerEmail').value;
                
                if (!lenderFirst || !lenderLast) {
                    alert('Please enter your (lender) full name');
                    return false;
                }
                if (!lenderEmail || !lenderEmail.includes('@')) {
                    alert('Please enter a valid lender email address');
                    return false;
                }
                if (!borrowerFirst || !borrowerLast) {
                    alert('Please enter borrower full name');
                    return false;
                }
                if (!borrowerEmail || !borrowerEmail.includes('@')) {
                    alert('Please enter a valid borrower email address');
                    return false;
                }
            }
            return true;
        }

        function updateProgress() {
            document.querySelectorAll('.step').forEach((step, index) => {
                const stepNumber = index + 1;
                if (stepNumber < currentStep) {
                    step.classList.add('completed');
                    step.classList.remove('active');
                } else if (stepNumber === currentStep) {
                    step.classList.add('active');
                    step.classList.remove('completed');
                } else {
                    step.classList.remove('active', 'completed');
                }
            });

            const progressPercentage = ((currentStep - 1) / (totalSteps - 1)) * 100;
            document.getElementById('progressLineActive').style.width = progressPercentage + '%';
        }

        function updatePreview() {
            const principal = parseFloat(document.getElementById('principalAmount').value) || 0;
            const fee = parseFloat(document.getElementById('serviceFee').value) || 0;
            const total = principal + fee;
            const purpose = document.getElementById('purpose').value;
            const dueDate = document.getElementById('dueDate').value;
            const schedule = document.getElementById('paymentSchedule').options[document.getElementById('paymentSchedule').selectedIndex].text;
            
            document.getElementById('previewPrincipal').textContent = '$' + principal.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            document.getElementById('previewTotal').textContent = '$' + total.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            
            if (fee > 0) {
                document.getElementById('previewFee').textContent = '$' + fee.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                document.getElementById('previewFeeSection').classList.remove('hidden');
            } else {
                document.getElementById('previewFeeSection').classList.add('hidden');
            }
            
            document.getElementById('previewPurpose').textContent = purpose ? purpose.charAt(0).toUpperCase() + purpose.slice(1).replace('_', ' ') : 'Not specified';
            document.getElementById('previewDueDate').textContent = dueDate ? new Date(dueDate + 'T00:00:00').toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }) : 'Not set';
            document.getElementById('previewSchedule').textContent = schedule;
            
            // Update parties
            const lenderFirst = document.getElementById('lenderFirstName').value;
            const lenderLast = document.getElementById('lenderLastName').value;
            const borrowerFirst = document.getElementById('borrowerFirstName').value;
            const borrowerLast = document.getElementById('borrowerLastName').value;
            
            if (lenderFirst && lenderLast) {
                document.getElementById('previewLender').textContent = lenderFirst + ' ' + lenderLast;
                document.getElementById('previewLenderSection').classList.remove('hidden');
            }
            
            if (borrowerFirst && borrowerLast) {
                document.getElementById('previewBorrower').textContent = borrowerFirst + ' ' + borrowerLast;
                document.getElementById('previewBorrowerSection').classList.remove('hidden');
            }

            // Update borrower email in signature section
            const borrowerEmail = document.getElementById('borrowerEmail').value;
            if (borrowerEmail) {
                document.getElementById('borrowerEmailPreview').textContent = borrowerEmail;
            }
        }

        function toggleLateFee() {
            const enabled = document.getElementById('enableLateFee').checked;
            document.getElementById('lateFeeOptions').classList.toggle('hidden', !enabled);
        }

        function toggleCollateral() {
            const enabled = document.getElementById('hasCollateral').checked;
            document.getElementById('collateralDetails').classList.toggle('hidden', !enabled);
        }

        function toggleBorrowerSignature() {
            const enabled = document.getElementById('collectBorrowerNow').checked;
            document.getElementById('borrowerSignatureSection').classList.toggle('hidden', !enabled);
            document.getElementById('borrowerInviteInfo').classList.toggle('hidden', enabled);
        }

        function setSignatureMethod(party, method) {
            if (party === 'lender') {
                lenderSignatureMethod = method;
                document.querySelectorAll('#step4 .signature-methods button').forEach((btn, idx) => {
                    if (idx < 2) btn.classList.remove('active');
                });
                event.target.classList.add('active');
                document.getElementById('lenderDrawMethod').classList.toggle('hidden', method !== 'draw');
                document.getElementById('lenderTypeMethod').classList.toggle('hidden', method !== 'type');
            } else {
                borrowerSignatureMethod = method;
                const buttons = document.querySelectorAll('#borrowerSignatureSection .signature-methods button');
                buttons.forEach(btn => btn.classList.remove('active'));
                event.target.classList.add('active');
                document.getElementById('borrowerDrawMethod').classList.toggle('hidden', method !== 'draw');
                document.getElementById('borrowerTypeMethod').classList.toggle('hidden', method !== 'type');
            }
        }

        function clearSignature(party) {
            if (party === 'lender') {
                lenderCtx.clearRect(0, 0, lenderCanvas.width, lenderCanvas.height);
            } else {
                borrowerCtx.clearRect(0, 0, borrowerCanvas.width, borrowerCanvas.height);
            }
        }

        function updateTypedSignature(party) {
            // In a real implementation, this would render the typed name in a signature font
            console.log(party + ' typed signature updated');
        }

        function verifyLenderSignature() {
            const hasSignature = lenderSignatureMethod === 'draw' ? 
                !isCanvasEmpty(lenderCanvas) : 
                document.getElementById('lenderTypedName').value.trim().length > 0;
            
            if (!hasSignature) {
                alert('Please provide your signature first');
                return;
            }

            // Simulate sending OTP
            alert('OTP sent to ' + document.getElementById('lenderEmail').value);
            document.getElementById('lenderOtpSection').classList.remove('hidden');
            document.getElementById('verifyLenderBtn').disabled = true;
        }

        function confirmLenderOtp() {
            // Simulate OTP verification
            lenderSigned = true;
            document.getElementById('lenderOtpSection').classList.add('hidden');
            document.getElementById('lenderSignedConfirm').classList.remove('hidden');
            checkSignatureCompletion();
        }

        function verifyBorrowerSignature() {
            const hasSignature = borrowerSignatureMethod === 'draw' ? 
                !isCanvasEmpty(borrowerCanvas) : 
                document.getElementById('borrowerTypedName').value.trim().length > 0;
            
            if (!hasSignature) {
                alert('Please provide borrower signature first');
                return;
            }

            // Simulate sending OTP
            alert('OTP sent to ' + document.getElementById('borrowerEmail').value);
            document.getElementById('borrowerOtpSection').classList.remove('hidden');
            document.getElementById('verifyBorrowerBtn').disabled = true;
        }

        function confirmBorrowerOtp() {
            // Simulate OTP verification
            borrowerSigned = true;
            document.getElementById('borrowerOtpSection').classList.add('hidden');
            document.getElementById('borrowerSignedConfirm').classList.remove('hidden');
            checkSignatureCompletion();
        }

        function checkSignatureCompletion() {
            const agreeTerms = document.getElementById('agreeTerms').checked;
            const collectBorrowerNow = document.getElementById('collectBorrowerNow').checked;
            
            const readyToGenerate = lenderSigned && agreeTerms && (!collectBorrowerNow || borrowerSigned);
            document.getElementById('generateBtn').disabled = !readyToGenerate;
        }

        document.getElementById('agreeTerms').addEventListener('change', checkSignatureCompletion);

        function isCanvasEmpty(canvas) {
            const ctx = canvas.getContext('2d');
            const pixelData = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
            for (let i = 0; i < pixelData.length; i += 4) {
                if (pixelData[i + 3] !== 0) return false;
            }
            return true;
        }

        function moveToNext(input, position) {
            if (input.value.length === 1 && position < 6) {
                const nextInput = input.parentElement.children[position];
                if (nextInput) nextInput.focus();
            }
        }

        function resendOtp(party) {
            alert('OTP resent to ' + (party === 'lender' ? document.getElementById('lenderEmail').value : document.getElementById('borrowerEmail').value));
        }

        function generateContract() {
            if (!lenderSigned) {
                alert('Please complete your signature verification');
                return;
            }

            const collectBorrowerNow = document.getElementById('collectBorrowerNow').checked;
            if (collectBorrowerNow && !borrowerSigned) {
                alert('Please complete borrower signature verification');
                return;
            }

            // Simulate contract generation
            nextStep();

            // Update success message
            if (collectBorrowerNow) {
                document.getElementById('borrowerStatusMessage').textContent = 'Both signatures have been verified and the contract is fully executed.';
                document.getElementById('nextStep2').textContent = 'Both parties have signed the contract';
            } else {
                document.getElementById('borrowerStatusMessage').textContent = 'An invitation to sign has been sent to the borrower.';
            }
        }

        function saveDraft() {
            const formData = {
                principalAmount: document.getElementById('principalAmount').value,
                serviceFee: document.getElementById('serviceFee').value,
                loanDate: document.getElementById('loanDate').value,
                dueDate: document.getElementById('dueDate').value,
                purpose: document.getElementById('purpose').value,
                currentStep: currentStep
            };
            localStorage.setItem('trustlend_draft', JSON.stringify(formData));
            alert('Draft saved! You can continue editing later.');
        }

        function formatPhone(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length > 10) value = value.slice(0, 10);
            
            if (value.length >= 6) {
                input.value = '(' + value.slice(0, 3) + ') ' + value.slice(3, 6) + '-' + value.slice(6);
            } else if (value.length >= 3) {
                input.value = '(' + value.slice(0, 3) + ') ' + value.slice(3);
            } else {
                input.value = value;
            }
        }
    </script>
</body>
</html>
